<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="../booking/final_booking.css">
</head>

<body>


  <div class="preferences">
    <div class="info">


      <div class="event">


        <h3 class="types">Select the event</h3>
        <form id="booking-form">
          <div class="events_options">

            <div class="bridal user_choice">
              <input type="radio" name="group" value="Bridal" class="input">
              <label>Bridal</label>

            </div>
            <div class="baby_shower user_choice">

              <input type="radio" name="group" value="Babyshower" class="input">
              <label>Baby shower</label>
            </div>


            <div class="engagement user_choice">
              <input type="radio" name="group" value="Engagement" class="input">
              <label>Engegement</label>
            </div>

            <div class="puberty user_choice">
              <input type="radio" name="group" value="Puberty" class="input">
              <label>Puberty</label>
            </div>

            <div class="birthday user_choice">
              <input type="radio" name="group" value="Birthday" class="input">
              <label>Birthday party</label>
            </div>
            <div class="photoshoots user_choice">
              <input type="radio" name="group" value="Photoshoot" class="input">
              <label>Photoshoots</label>
            </div>
          </div>

      </div>


      <div class="booking_details">

        <h3>Book Your Booking now!!</h3>



        <div class="name_num  inputs">
          <div class="cus_name">

            <i class="fa-sharp fa-solid fa-user"></i>

            <input type="text" placeholder="Name" id="Name-of-customer">
          </div>
          <div class="cus_num">
            <i class="fa-solid fa-mobile-screen"></i>
            <input type="number" placeholder="Mobile number" id="contact-of-customer">
          </div>


        </div>



        <div class="cus_address inputs">

          <i class="fa-solid fa-location-dot"></i>
          <input type="text" placeholder="Address" id="address-customer">

        </div>
        <div class="door_num inputs">
          <i class="fa-solid fa-door-open"></i>
          <input type="text" placeholder="Door Number">
        </div>
        <div class="date_time inputs">

          <div class="date">
            <i class="fa-solid fa-calendar-days"></i>
            <input type="date" placeholder="Date" id="date-choosen-customer">

          </div>
          <div class="time inputs">

            <i class="fa-solid fa-clock"></i>
            <input type="time" placeholder="hrs:mins" id="Time-choosen-customer">

          </div>
        </div>
        <div class="selected_option inputs">
          <i class="fa-solid fa-indian-rupee-sign " id="rupee"></i>
          <label>Selected option</label>
          <input type="text">
        </div>

        <h4>Total Amount : <i class="fa-solid fa-indian-rupee-sign"></i><span id="total-amount"></span></h4>
        <button type="submit">Book now</button>

      </div>
      </form>
    </div>

  </div>






  <div id="popup-container">
    <div id="popup-message">
      <h3>Your booking successfully completed</h3>
    </div>
    <button id="close-button">Close</button>
  </div>

  </div>
  <script>



let search_url = window.location.search;  //?name=Bridal MAkeup by sharmila
    let getid  = new URLSearchParams(search_url)
    let id = getid.get("bookingId");



    let url = window.location.search;  //?name=Bridal MAkeup by sharmila
    let urls = new URLSearchParams(url)
    let name = urls.get("param2");



const radioButtons = document.getElementsByName("group");
    let selectedValue
    for (let i = 0; i < radioButtons.length; i++) {
      radioButtons[i].addEventListener("click", function () {
        if (this.checked) {
          selectedValue = this.value;

        }
      });
    }




    let bookinkdata=JSON.parse(localStorage.getItem("bookingDatas"))
    console.log(bookinkdata)

    let form_filled = document.getElementById("booking-form")
    form_filled.addEventListener('submit', e => {
      e.preventDefault();

      let data_of_cus = JSON.parse(localStorage.getItem("data"));
      let dataofartist = JSON.parse(localStorage.getItem("card_data"));/*registered information of artist with their name an so on*/
      let active_user = localStorage.getItem("profile").value /* active login of artist email*/





      const name_client = document.getElementById("Name-of-customer").value

      const contact_client = document.getElementById("contact-of-customer").value
      const addres_client = document.getElementById("address-customer").value
      const time_client = document.getElementById("Time-choosen-customer").value
      const address = document.getElementById("address-customer").value

      const emailofcus = localStorage.getItem("profile")

      // let isBooked = dataofartist.some(artist => {
      //   return artist.name === name && artist.booking_records.some(record => {
      //     return record.time === time_client;
      //   });
      // });

 


      // if (isBooked) {
      //   const failedmessage = ` This  date and time  is already booked for ${name}
      //       You can procedue your booking with some other person  or you can choose some other timing you need .Thank you!`
      //   const popupContainer = document.getElementById('popup-container');
      //   const popupMessage = document.getElementById('popup-message');
      //   popupMessage.textContent = failedmessage;
      //   popupContainer.style.display = 'block';


      //   const closeButton = document.getElementById('close-button');
      //   closeButton.addEventListener('click', function () {
      //     const popupContainer = document.getElementById('popup-container');
      //     popupContainer.style.display = 'none';

      //   });


        const bookingInfo = JSON.parse(localStorage.getItem("bookingDatas")).find(booking => booking.bookingId === parseInt(id));


// // Display the booking information on the page
// document.querySelector(".booking_id").value = bookingId;
// document.querySelector(".selected_artist").value = selectedArtist;
// document.querySelector(".booking_total_cost").value = "Booking Total Cost: ₹ " + bookingTotalCost;
// document.querySelector(".customer_name").value = customerName;
// document.querySelector(".customer_email").value = customerEmail;
// document.querySelector(".customer_address").value = customerAddress;



    

        console.log(emailofcus)
        const booking_info = JSON.parse(localStorage.getItem("records_booking_clients"))
        if ((name_client.trim() != "") && (time_client.trim() != "") && (contact_client.trim() != "") && (addres_client.trim() != "")  && selectedValue) {
          let records_booking_clients = JSON.parse(localStorage.getItem("records_booking_clients")) ? JSON.parse(localStorage.getItem("records_booking_clients")) : []
          let object_booking_records = {
            "customer_name": name_client,
            "customer_email": emailofcus,
            "customer_contact": contact_client,
            "customer_address": addres_client,
            // "event_date": date_event_client,
            "time": time_client,
            "status": false,
            "bookingTotalCost": bookingTotalCost,
  "bookingDetails": bookingDetails,
            "selected_event": selectedValue,
            "se": option,
            "location": address,       
            "id": records_booking_clients.length,
            "selected_artist_for_booking": name ,
            
            /*store the object of form filled by user with selected artist name*/
          }
          records_booking_clients.push(object_booking_records);
          // console.log(records_booking_clients)
          localStorage.setItem("records_booking_clients", JSON.stringify(records_booking_clients));
          // Add booking info to artist's data
          let artist = dataofartist.find((obj) => obj.name === name);
          artist.booking_records = records_booking_clients.filter(element => element.selected_artist_for_booking === artist.name);

          let customer = data_of_cus.find((obj) => obj.user_email === emailofcus);
          customer.booking_record = records_booking_clients.filter(element => element.customer_email === emailofcus);
          localStorage.setItem("card_data", JSON.stringify(dataofartist));
          localStorage.setItem("data", JSON.stringify(data_of_cus));

          const successMessage = `Booking successful! Have a great day with ${object_booking_records.selected_artist_for_booking}`;
          const popupContainer = document.getElementById('popup-container');
          const popupMessage = document.getElementById('popup-message');
          popupMessage.textContent = successMessage;
          popupContainer.style.display = 'block';


        }
        else {
          alert("Fill the required data")

        }
      
    })



// // Display the booking information on the page
// document.querySelector(".booking_id").value = bookingId;
// document.querySelector(".selected_artist").value = selectedArtist;
// document.querySelector(".booking_total_cost").value = "Booking Total Cost: ₹ " + bookingTotalCost;
// document.querySelector(".customer_name").value = customerName;
// document.querySelector(".customer_email").value = customerEmail;
// document.querySelector(".customer_address").value = customerAddress;







  </script>
</body>

</html>
